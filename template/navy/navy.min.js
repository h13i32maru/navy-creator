!function(){"use strict";window.Navy={View:{},ViewGroup:{},Transition:{}};window.addEventListener("DOMContentLoaded",function(){Navy.App.initialize()});Navy.Class=function(){var t;var e;switch(arguments.length){case 1:e=Navy.Class._RootClass;t=arguments[0];break;case 2:if(typeof arguments[0]==="function"){e=arguments[0]}else{e=arguments[0].constructor}t=arguments[1];break;default:throw new Error("arguments of Navy.Class is 1 or 2.")}return Navy.Class._create(e,t)};Navy.Class.instance=function t(t){var e=Navy.Class.apply(Navy,arguments);e.__manualInitialize__=true;var i=new e;return i};Navy.Class._RootClass=function e(){};Navy.Class._RootClass.prototype.initialize=function(){};Navy.Class._create=function i(t,e){var i=e.CLASSNAME||"Constructor";i=i.replace(/[.]/g,"$");var n=new Function("return function "+i+" () { if (typeof this.initialize === 'function' && !this.constructor.__manualInitialize__) { this.initialize.apply(this, arguments); } }")();function a(){}a.prototype=t.prototype;var o=new a;var s=new a;n.prototype=o;var r;var l;for(r in e){l=e[r];if(typeof l==="object"&&l!==null){if(r!=="$static"){throw new Error("object property must be primitive type. property = "+r)}}if(typeof l==="function"){if(Navy.Class._argumentNames(l)[0]==="$super"){l=Navy.Class._wrapFunction(s,r,l)}}n.prototype[r]=l}n.prototype.constructor=n;return n};Navy.Class._argumentNames=function n(t){var e=t.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e};Navy.Class._wrapFunction=function a(t,e,i){if(typeof t[e]!=="function"){throw new Error("override method must be function. function = "+e)}return function(){var n=this;var $super=function(){return t[e].apply(n,arguments)};var a=[$super].concat(Array.prototype.slice.call(arguments,0));return i.apply(this,a)}};Navy.Notify=Navy.Class({CLASSNAME:"Navy.Notify",_count:null,_callback:null,initialize:function(t,e){if(arguments.length===2){this.set(t,e)}},pass:function(){this._count--;if(this._count===0){this._callback()}},set:function(t,e){if(t===0){e()}else{this._count=t;this._callback=e}}});Navy.App=Navy.Class.instance({CLASSNAME:"Navy.App",_initRootBeforeCallback:null,initialize:function(){Navy.Resource.initialize();Navy.Config.initialize(this._onInitConfig.bind(this))},setInitRootBeforeCallback:function(t){this._initRootBeforeCallback=t},_onInitConfig:function(){this._initRootBeforeCallback&&this._initRootBeforeCallback();Navy.Root.initialize()}});Navy.Config=Navy.Class.instance({CLASSNAME:"Navy.Config",app:null,scene:null,page:null,initialize:function(t){var e=new Navy.Notify(3,t);var i=e.pass.bind(e);this._loadAppJSON(i);this._loadSceneJSON(i);this._loadPageJSON(i)},_loadAppJSON:function(t){var e=new XMLHttpRequest;e.open("GET","config/app.json");e.onload=function(e){var i=e.target;this.app=JSON.parse(i.responseText);t()}.bind(this);e.send()},_loadSceneJSON:function(t){var e=new XMLHttpRequest;e.open("GET","config/scene.json");e.onload=function(e){var i=e.target;var n=JSON.parse(i.responseText);var a={};for(var o=0;o<n.length;o++){a[n[o].id]=n[o]}this.scene=a;t()}.bind(this);e.send()},_loadPageJSON:function(t){var e=new XMLHttpRequest;e.open("GET","config/page.json");e.onload=function(e){var i=e.target;var n=JSON.parse(i.responseText);var a={};for(var o=0;o<n.length;o++){a[n[o].id]=n[o]}this.page=a;t()}.bind(this);e.send()}});Navy.Resource=Navy.Class.instance({CLASSNAME:"Navy.Resource",_layouts:null,_scripts:null,_images:null,initialize:function(){this._layouts={};this._scripts={};this._images={}},loadLayout:function(t,e){if(this._layouts[t]){var i=this._layouts[t];var n=JSON.parse(i);e&&setTimeout(e.bind(null,n),0);return}var a=new XMLHttpRequest;a.open("GET",t);a.onload=function(i){var n=i.target;var a=n.responseText;this._layouts[t]=a;var o=JSON.parse(a);e(o)}.bind(this);a.send()},loadScript:function(t,e){if(this._scripts[t]){e&&setTimeout(e,0);return}var i=document.createElement("script");i.onload=function(){this._scripts[t]=true;e()}.bind(this);i.src=t;document.head.appendChild(i)},loadImage:function(t,e){if(this._images[t]){e&&setTimeout(e.bind(null,t),0);return}var i=new Image;i.onload=function(){this._images[t]=true;e(t)}.bind(this);i.src=t},getClass:function(t){var e=t.split(".");var i=window;for(var n=0;n<e.length;n++){i=i[e[n]]}return i}});Navy.View.View=Navy.Class({CLASSNAME:"Navy.View.View",_layout:null,_element:null,_parentView:null,initialize:function(t,e){this._layout=t;this._element=document.createElement("div");this.setLayout(t,e)},setLayout:function(t,e){if(!t){return}var i={position:"absolute",left:t.pos.x+"px",top:t.pos.y+"px",zIndex:t.pos.z,width:t.size.width+"px",height:t.size.height+"px",backgroundColor:t.backgroundColor};this.setRawStyle(i);e&&setTimeout(e.bind(null,this),0)},setRawStyle:function(t){var e="";for(var i in t){var n=t[i];if(n!==undefined){var a=i.replace(/([A-Z])/g,"-$1").toLowerCase();if(a.indexOf("webkit")===0){a="-"+a}if(n===""){this._element.style[i]=""}else{e+=a+":"+n+";"}}}this._element.style.cssText+=e},addRawEventListener:function(t,e){this._element.addEventListener(t,e)},removeRawEventListener:function(t,e){this._element.removeEventListener(t,e)},getId:function(){return this._layout.id},getElement:function(){return this._element},setParent:function(t){this._parentView=t},show:function(){this._element.style.display=""},hide:function(){this._element.style.display="none"},setPos:function(t){var e="";if(typeof t.x==="number"){this._layout.pos.x=t.x;e+="left:"+t.x+"px;"}if(typeof t.y==="number"){this._layout.pos.y=t.y;e+="top:"+t.y+"px;"}if(typeof t.z==="number"){this._layout.pos.z=t.z;e+="z-index:"+t.z+";"}this._element.style.cssText+=e},addPos:function(t){var e=this._layout.pos.x+(t.x||0);var i=this._layout.pos.y+(t.y||0);this.setPos({x:e,y:i})},getPos:function(){return{x:this._layout.pos.x,y:this._layout.pos.y,z:this._layout.pos.z}},destroy:function(){this._parentView.removeView(this);this._element=null},toJSON:function(){return this._layout}});Navy.View.Image=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.View.Image",_imgElm:null,initialize:function($super,t,e){$super(t,e)},setLayout:function($super,t,e){$super(t);if(!this._imgElm){var i=document.createElement("img");this._element.appendChild(i);this._imgElm=i}if(t&&t.extra.src){Navy.Resource.loadImage(t.extra.src,function(t){this._onLoadImage(t);e&&e(this)}.bind(this))}else{this._layout.extra.src=null;this._imgElm.src="";e&&setTimeout(e,0)}},_onLoadImage:function(t){this._layout.extra.src=t;this._imgElm.src=t}});Navy.View.Text=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.View.Text",_textElement:null,initialize:function($super,t,e){$super(t,e)},setLayout:function($super,t,e){$super(t);if(!t){return}if(!this._textElement){this._textElement=document.createElement("span");this._element.appendChild(this._textElement)}if(t.extra){this._layout.extra.text=t.extra.text;this._textElement.textContent=t.extra.text}e&&setTimeout(e.bind(null,this),0)}});Navy.ViewGroup.ViewGroup=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.ViewGroup.ViewGroup",_views:null,_initCallback:null,initialize:function($super,t,e){this._views={};$super(t,e)},setLayout:function($super,t,e){$super(t);if(t&&t.extra.contentLayoutFile){this._layout.extra.contentLayoutFile=t.extra.contentLayoutFile;e=e||function(){};this._initCallback=e.bind(null,this);Navy.Resource.loadLayout(t.extra.contentLayoutFile,this._onLoadContentLayout.bind(this))}else{this._layout&&(this._layout.extra.contentLayoutFile=null);e&&setTimeout(e.bind(null,this),0)}},_onLoadContentLayout:function(t){var e=new Navy.Notify(t.length,this._initCallback);var i=e.pass.bind(e);for(var n=0;n<t.length;n++){var a=t[n];var o=Navy.Resource.getClass(a.class);var s=new o(a,i);this.addView(s)}},findViewByElement:function(t){var e=this._views;for(var i in e){var n=e[i];if(n.getElement()===t){return n}}return null},addView:function(t){var e=t.getElement();this._element.appendChild(e);this._views[t.getId()]=t;t.setParent(this)},removeView:function(t){var e=t.getElement();this._element.removeChild(e);this._views[t.getId()]=null;delete this._views[t.getId()];t.setParent(null)}});Navy.Page=Navy.Class(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Page",initialize:function($super,t,e){t.pos={x:0,y:0};t.size={width:Navy.Config.app.size.width,height:Navy.Config.app.size.height};$super(t,e)},onCreate:function(){console.log("onCreate",this.CLASSNAME)},onResumeBefore:function(){console.log("onResumeBefore",this.CLASSNAME)},onResumeAfter:function(){console.log("onResumeAfter",this.CLASSNAME)},onPauseBefore:function(){console.log("onPauseBefore",this.CLASSNAME)},onPauseAfter:function(){console.log("onPauseAfter",this.CLASSNAME)},onDestroy:function(){console.log("onDestroy",this.CLASSNAME)}});Navy.Root=Navy.Class.instance(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Root",_sceneStack:null,initialize:function($super){$super();this._initDocument();var t=document.body;this._sceneStack=[];var e=document.createElement("div");e.style.cssText="position:absolute; width:100%; height:100%; overflow:hidden;";t.appendChild(e);this._element=e;var i=Navy.Config.app.start.scene;this.nextScene(i)},nextScene:function(t){this._createScene(t,this._addScene.bind(this))},backScene:function(){if(this._sceneStack.length>=2){var t=this._getPrevStack();t.scene.onResumeBefore();var e=this._getCurrentStack();e.scene.onPauseBefore();e.transition.back(this._onTransitionBackEnd.bind(this))}},_initDocument:function(){var t="* {margin:0; padding:0; -webkit-user-select: none; -webkit-user-drag:none;} html {width:100%; height:100%} body {background-color:#000;}";var e=document.createElement("style");e.textContent=t;document.head.appendChild(e);var i=Navy.Config.app.size.width;var n=Navy.Config.app.size.height;var a=window.innerWidth;var o=window.innerHeight;var s=a/i;var r=o/n;var l=Math.min(s,r);var u=(a-l*i)/2;var c=(o-l*n)/2;document.body.style.position="absolute";document.body.style.zoom=l;document.body.style.width=i+"px";document.body.style.height=n+"px";document.body.style.left=u+"px";document.body.style.top=c+"px"},_createScene:function(t,e){var i=Navy.Config.scene[t];Navy.Resource.loadScript(i.classFile,this._onLoadScript.bind(this,i,e))},_onLoadScript:function(t,e){var i=Navy.Resource.getClass(t.class);new i(t,e)},_addScene:function(t){t.onCreate();t.onResumeBefore();var e=this._getCurrentStack();if(e){var i=e.scene;i.onPauseBefore()}var n=new Navy.Transition.Fade(i,t);this._sceneStack.push({scene:t,transition:n});this.addView(t);n.start(this._onTransitionStartEnd.bind(this))},_removeCurrentScene:function(){var t=this._sceneStack.pop();t.scene.destroy()},_getCurrentStack:function(){if(this._sceneStack.length>=1){return this._sceneStack[this._sceneStack.length-1]}else{return null}},_getPrevStack:function(){if(this._sceneStack.length>=2){return this._sceneStack[this._sceneStack.length-2]}else{return null}},_onTransitionStartEnd:function(){var t=this._getPrevStack();if(t){t.scene.onPauseAfter()}var e=this._getCurrentStack();if(e){e.scene.onResumeAfter()}},_onTransitionBackEnd:function(){var t=this._getPrevStack();if(t){t.scene.onResumeAfter()}var e=this._getCurrentStack();if(e){e.scene.onPauseAfter();e.scene.onDestroy();this._removeCurrentScene()}}});Navy.Scene=Navy.Class(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Scene",_pageStack:null,initialize:function($super,t,e){this._pageStack=[];t.pos={x:0,y:0};t.size={width:Navy.Config.app.size.width,height:Navy.Config.app.size.height};$super(t,function(){var i=this._views;for(var n in i){i[n].setPos({z:100})}this.nextPage(t.extra.page,e.bind(null,this));i[n].addRawEventListener("touchend",function(t){t.stopPropagation();Navy.Root.nextScene("Scene1")})}.bind(this));var i=function(){if(this._pageStack.length<5){this.nextPage("Page"+(Date.now()%2+1))}else{this._element.removeEventListener("touchend",i);this._element.addEventListener("touchend",function t(){this.backPage()}.bind(this))}}.bind(this);this._element.addEventListener("touchend",i)},nextPage:function(t,e){this._createPage(t,function(t){this._addPage(t);e&&e(t)}.bind(this))},backPage:function(){if(this._pageStack.length>=2){var t=this._pageStack[this._pageStack.length-1];var e=t.transition;e.back(this._onTransitionBackEnd.bind(this))}},onCreate:function(){console.log("onCreate",this.CLASSNAME)},onResumeBefore:function(){console.log("onResumeBefore",this.CLASSNAME)},onResumeAfter:function(){console.log("onResumeAfter",this.CLASSNAME)},onPauseBefore:function(){console.log("onPauseBefore",this.CLASSNAME)},onPauseAfter:function(){console.log("onPauseAfter",this.CLASSNAME)},onDestroy:function(){console.log("onDestroy",this.CLASSNAME)},_getBottomPageLayout:function(t){var e={"class":"Navy.Page",id:"$bottom",pos:{x:0,y:0},size:{width:t.size.width,height:t.size.height},extra:{contentLayoutFile:t.extra.contentBottomLayoutFile}};return e},_getTopPageLayout:function(t){var e={"class":"Navy.Page",id:"$top",pos:{x:0,y:0,z:100},size:{width:t.size.width,height:t.size.height},extra:{contentLayoutFile:t.extra.contentTopLayoutFile}};return e},_createPage:function(t,e){var i=Navy.Config.page[t];Navy.Resource.loadScript(i.classFile,this._onLoadScript.bind(this,i,e))},_createPageByLayout:function(t,e){var i=Navy.Resource.getClass(t.class);new i(t,e)},_onLoadScript:function(t,e){var i=Navy.Resource.getClass(t.class);new i(t,e)},_addPage:function(t){t.onCreate();t.onResumeBefore();var e=this._getCurrentStack();if(e){var i=e.page;i.onPauseBefore()}var n=new Navy.Transition.SlideOver(i,t);this._pageStack.push({page:t,transition:n});this.addView(t);n.start(this._onTransitionStartEnd.bind(this))},_getCurrentStack:function(){if(this._pageStack.length>=1){return this._pageStack[this._pageStack.length-1]}else{return null}},_getPrevStack:function(){if(this._pageStack.length>=2){return this._pageStack[this._pageStack.length-2]}else{return null}},_onTransitionStartEnd:function(){var t=this._getPrevStack();if(t){t.page.onPauseAfter()}var e=this._getCurrentStack();if(e){e.page.onResumeAfter()}},_onTransitionBackEnd:function(){var t=this._getPrevStack();if(t){t.page.onResumeAfter()}var e=this._getCurrentStack();if(e){e.page.onPauseAfter();e.page.onDestroy();var i=this._pageStack.pop();i.page.destroy()}}});Navy.Transition.Transition=Navy.Class({CLASSNAME:"Navy.Transition.Transition",initialize:function(t,e){},start:function(t){},back:function(t){}});Navy.Transition.Fade=Navy.Class(Navy.Transition.Transition,{CLASSNAME:"Navy.Transition.Fade",$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$static.initAnimationStyle){this._addAnimationStyle();this.$static.initAnimationStyle=true}t&&t.setRawStyle({webkitAnimation:"0.5s"});e&&e.setRawStyle({webkitAnimation:"0.5s",opacity:0})},_addAnimationStyle:function(){var t="@-webkit-keyframes fade_in  {100% {opacity: 1}}";var e="@-webkit-keyframes fade_out {100% {opacity: 0}}";var i=document.createElement("style");i.textContent=t+e;document.head.appendChild(i)},start:function(t){if(!this._beforeView){this._afterView.setRawStyle({opacity:""});t&&t();return}var e=function(){this._beforeView.hide();this._beforeView.setRawStyle({webkitAnimationName:""});this._beforeView.removeRawEventListener("webkitAnimationEnd",e);this._afterView.addRawEventListener("webkitAnimationEnd",i);this._afterView.setRawStyle({opacity:0,webkitAnimationName:"fade_in"})}.bind(this);var i=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",i);this._afterView.setRawStyle({opacity:"",webkitAnimationName:"none"});t&&t()}.bind(this);this._beforeView.addRawEventListener("webkitAnimationEnd",e);this._beforeView.setRawStyle({webkitAnimationName:"fade_out"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.hide();this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView.setRawStyle({webkitAnimationName:"none"});this._beforeView.addRawEventListener("webkitAnimationEnd",i);this._beforeView.setRawStyle({opacity:0,webkitAnimationName:"fade_in"});this._beforeView.show()}.bind(this);var i=function(){this._beforeView.removeRawEventListener("webkitAnimationEnd",i);this._beforeView.setRawStyle({opacity:"",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView.setRawStyle({webkitAnimationName:"fade_out"})}});Navy.Transition.SlideOver=Navy.Class(Navy.Transition.Transition,{CLASSNAME:"Navy.Transition.SlideOver",$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$static.initAnimationStyle){this._addAnimationStyle();this.$static.initAnimationStyle=true}var i=Navy.Config.app.size.width;e.setRawStyle({webkitAnimation:"0.5s",webkitTransform:"translateX("+i+"px)"})},_addAnimationStyle:function(){var t=Navy.Config.app.size.width;var e="@-webkit-keyframes slide_over_in  {100% {-webkit-transform: translateX(0)}}";var i="@-webkit-keyframes slide_over_out {100% {-webkit-transform: translateX(%width%px)}}".replace("%width%",t);var n=document.createElement("style");n.textContent=e+i;document.head.appendChild(n)},start:function(t){if(!this._beforeView){this._afterView.setRawStyle({webkitTransform:"none"});t&&t();return}var e=function(){this._beforeView.hide();this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView.setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView.setRawStyle({webkitAnimationName:"slide_over_in"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",e);t&&t()}.bind(this);this._beforeView.show();this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView.setRawStyle({webkitAnimationName:"slide_over_out"})}})}();