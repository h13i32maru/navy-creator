!function(){"use strict";window.Navy={View:{},ViewGroup:{},Transition:{}};window.addEventListener("DOMContentLoaded",function(){Navy.App.initialize()});Navy.Class=function(){var e;var t;switch(arguments.length){case 1:t=Navy.Class._RootClass;e=arguments[0];break;case 2:if(typeof arguments[0]==="function"){t=arguments[0]}else{t=arguments[0].constructor}e=arguments[1];break;default:throw new Error("arguments of Navy.Class is 1 or 2.")}return Navy.Class._create(t,e)};Navy.Class.instance=function e(e){var t=Navy.Class.apply(Navy,arguments);t.__manualInitialize__=true;var i=new t;return i};Navy.Class._RootClass=function t(){};Navy.Class._RootClass.prototype.initialize=function(){};Navy.Class._create=function i(e,t){var i=t.CLASSNAME||"Constructor";i=i.replace(/[.]/g,"$");var n=new Function("return function "+i+" () { if (typeof this.initialize === 'function' && !this.constructor.__manualInitialize__) { this.initialize.apply(this, arguments); } }")();function a(){}a.prototype=e.prototype;var o=new a;var s=new a;n.prototype=o;var r;var l;for(r in t){l=t[r];if(typeof l==="object"&&l!==null){if(r!=="$static"){throw new Error("object property must be primitive type. property = "+r)}}if(typeof l==="function"){if(Navy.Class._argumentNames(l)[0]==="$super"){l=Navy.Class._wrapFunction(s,r,l)}}n.prototype[r]=l}n.prototype.constructor=n;return n};Navy.Class._argumentNames=function n(e){var t=e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return t.length==1&&!t[0]?[]:t};Navy.Class._wrapFunction=function a(e,t,i){if(typeof e[t]!=="function"){throw new Error("override method must be function. function = "+t)}return function(){var n=this;var $super=function(){return e[t].apply(n,arguments)};var a=[$super].concat(Array.prototype.slice.call(arguments,0));return i.apply(this,a)}};Navy.Notify=Navy.Class({CLASSNAME:"Navy.Notify",_count:null,_callback:null,initialize:function(e,t){if(arguments.length===2){this.set(e,t)}},pass:function(){this._count--;if(this._count===0){this._callback()}},set:function(e,t){if(e===0){t()}else{this._count=e;this._callback=t}}});Navy.App=Navy.Class.instance({CLASSNAME:"Navy.App",_initRootBeforeCallback:null,initialize:function(){Navy.Resource.initialize();Navy.Config.initialize(this._onInitConfig.bind(this))},setInitRootBeforeCallback:function(e){this._initRootBeforeCallback=e},_onInitConfig:function(){this._initRootBeforeCallback&&this._initRootBeforeCallback();Navy.Root.initialize()}});Navy.Config=Navy.Class.instance({CLASSNAME:"Navy.Config",app:null,scene:null,page:null,initialize:function(e){var t=new Navy.Notify(3,e);var i=t.pass.bind(t);this._loadAppJSON(i);this._loadSceneJSON(i);this._loadPageJSON(i)},_loadAppJSON:function(e){var t=new XMLHttpRequest;t.open("GET","config/app.json");t.onload=function(t){var i=t.target;this.app=JSON.parse(i.responseText);e()}.bind(this);t.send()},_loadSceneJSON:function(e){var t=new XMLHttpRequest;t.open("GET","config/scene.json");t.onload=function(t){var i=t.target;var n=JSON.parse(i.responseText);var a={};for(var o=0;o<n.length;o++){a[n[o].id]=n[o]}this.scene=a;e()}.bind(this);t.send()},_loadPageJSON:function(e){var t=new XMLHttpRequest;t.open("GET","config/page.json");t.onload=function(t){var i=t.target;var n=JSON.parse(i.responseText);var a={};for(var o=0;o<n.length;o++){a[n[o].id]=n[o]}this.page=a;e()}.bind(this);t.send()}});Navy.Resource=Navy.Class.instance({CLASSNAME:"Navy.Resource",_layouts:null,_scripts:null,_images:null,initialize:function(){this._layouts={};this._scripts={};this._images={}},loadLayout:function(e,t){if(this._layouts[e]){var i=this._layouts[e];var n=JSON.parse(i);t&&setTimeout(t.bind(null,n),0);return}var a=new XMLHttpRequest;a.open("GET",e);a.onload=function(i){var n=i.target;var a=n.responseText;this._layouts[e]=a;var o=JSON.parse(a);t(o)}.bind(this);a.send()},loadScript:function(e,t){if(this._scripts[e]){t&&setTimeout(t,0);return}var i=document.createElement("script");i.onload=function(){this._scripts[e]=true;t()}.bind(this);i.src=e;document.head.appendChild(i)},loadImage:function(e,t){if(this._images[e]){t&&setTimeout(t.bind(null,e),0);return}var i=new Image;i.onload=function(){this._images[e]=true;t(e)}.bind(this);i.src=e},getClass:function(e){var t=e.split(".");var i=window;for(var n=0;n<t.length;n++){i=i[t[n]]}return i}});Navy.View.View=Navy.Class({CLASSNAME:"Navy.View.View",_layout:null,_element:null,_parentView:null,initialize:function(e,t){this._layout=e;this._element=document.createElement("div");this.setLayout(e,t)},setLayout:function(e,t){if(!e){return}var i={position:"absolute",left:e.pos.x+"px",top:e.pos.y+"px",zIndex:e.pos.z,width:e.size.width+"px",height:e.size.height+"px",backgroundColor:e.backgroundColor};this.setRawStyle(i);t&&setTimeout(t.bind(null,this),0)},setRawStyle:function(e){var t="";for(var i in e){var n=e[i];if(n!==undefined){var a=i.replace(/([A-Z])/g,"-$1").toLowerCase();if(a.indexOf("webkit")===0){a="-"+a}if(n===""){this._element.style[i]=""}else{t+=a+":"+n+";"}}}this._element.style.cssText+=t},addRawEventListener:function(e,t){this._element.addEventListener(e,t)},removeRawEventListener:function(e,t){this._element.removeEventListener(e,t)},getId:function(){return this._layout.id},getElement:function(){return this._element},setParent:function(e){this._parentView=e},show:function(){this._element.style.display=""},hide:function(){this._element.style.display="none"},setPos:function(e){var t="";if(typeof e.x==="number"){this._layout.pos.x=e.x;t+="left:"+e.x+"px;"}if(typeof e.y==="number"){this._layout.pos.y=e.y;t+="top:"+e.y+"px;"}if(typeof e.z==="number"){this._layout.pos.z=e.z;t+="z-index:"+e.z+";"}this._element.style.cssText+=t},destroy:function(){this._parentView.removeView(this);this._element=null}});Navy.View.Image=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.View.Image",_imgElm:null,initialize:function($super,e,t){$super(e,t)},setLayout:function($super,e,t){$super(e);if(!this._imgElm){var i=document.createElement("img");this._element.appendChild(i);this._imgElm=i}Navy.Resource.loadImage(e.extra.src,function(e){this._onLoadImage(e);t&&t(this)}.bind(this))},_onLoadImage:function(e){this._layout.extra.src=e;this._imgElm.src=e}});Navy.View.Text=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.View.Text",_textElement:null,initialize:function($super,e,t){$super(e,t)},setLayout:function($super,e,t){$super(e);if(!e){return}if(!this._textElement){this._textElement=document.createElement("span");this._element.appendChild(this._textElement)}if(e.extra){this._layout.extra.text=e.extra.text;this._textElement.textContent=e.extra.text}t&&setTimeout(t.bind(null,this),0)}});Navy.ViewGroup.ViewGroup=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.ViewGroup.ViewGroup",_views:null,_initCallback:null,initialize:function($super,e,t){this._views={};$super(e,t)},setLayout:function($super,e,t){$super(e);if(e&&e.extra.contentLayoutFile){this._layout.extra.contentLayoutFile=e.extra.contentLayoutFile;t=t||function(){};this._initCallback=t.bind(null,this);Navy.Resource.loadLayout(e.extra.contentLayoutFile,this._onLoadContentLayout.bind(this))}else{this._layout&&(this._layout.extra.contentLayoutFile=null);t&&setTimeout(t.bind(null,this),0)}},_onLoadContentLayout:function(e){var t=new Navy.Notify(e.length,this._initCallback);var i=t.pass.bind(t);for(var n=0;n<e.length;n++){var a=e[n];var o=Navy.Resource.getClass(a.class);var s=new o(a,i);this.addView(s)}},addView:function(e){var t=e.getElement();this._element.appendChild(t);this._views[e.getId()]=e;e.setParent(this)},removeView:function(e){var t=e.getElement();this._element.removeChild(t);this._views[e.getId()]=null;delete this._views[e.getId()];e.setParent(null)}});Navy.Page=Navy.Class(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Page",onCreate:function(){console.log("onCreate",this.CLASSNAME)},onResumeBefore:function(){console.log("onResumeBefore",this.CLASSNAME)},onResumeAfter:function(){console.log("onResumeAfter",this.CLASSNAME)},onPauseBefore:function(){console.log("onPauseBefore",this.CLASSNAME)},onPauseAfter:function(){console.log("onPauseAfter",this.CLASSNAME)},onDestroy:function(){console.log("onDestroy",this.CLASSNAME)}});Navy.Root=Navy.Class.instance(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Root",_sceneStack:null,initialize:function($super){$super();this._initDocument();var e=document.body;this._sceneStack=[];var t=document.createElement("div");t.style.cssText="position:absolute; width:100%; height:100%; overflow:hidden;";e.appendChild(t);this._element=t;var i=Navy.Config.app.start.scene;this.nextScene(i)},nextScene:function(e){this._createScene(e,this._addScene.bind(this))},backScene:function(){if(this._sceneStack.length>=2){var e=this._getPrevStack();e.scene.onResumeBefore();var t=this._getCurrentStack();t.scene.onPauseBefore();t.transition.back(this._onTransitionBackEnd.bind(this))}},_initDocument:function(){var e="* {margin:0; padding:0;} html {width:100%; height:100%} body {background-color:#000;}";var t=document.createElement("style");t.textContent=e;document.head.appendChild(t);var i=Navy.Config.app.size.width;var n=Navy.Config.app.size.height;var a=window.innerWidth;var o=window.innerHeight;var s=a/i;var r=o/n;var l=Math.min(s,r);var c=(a-l*i)/2;var u=(o-l*n)/2;document.body.style.position="absolute";document.body.style.zoom=l;document.body.style.width=i+"px";document.body.style.height=n+"px";document.body.style.left=c+"px";document.body.style.top=u+"px"},_createScene:function(e,t){var i=Navy.Config.scene[e];Navy.Resource.loadScript(i.classFile,this._onLoadScript.bind(this,i,t))},_onLoadScript:function(e,t){var i=Navy.Resource.getClass(e.class);new i(e,t)},_addScene:function(e){e.onCreate();e.onResumeBefore();var t=this._getCurrentStack();if(t){var i=t.scene;i.onPauseBefore()}var n=new Navy.Transition.Fade(i,e);this._sceneStack.push({scene:e,transition:n});this.addView(e);n.start(this._onTransitionStartEnd.bind(this))},_removeCurrentScene:function(){var e=this._sceneStack.pop();e.scene.destroy()},_getCurrentStack:function(){if(this._sceneStack.length>=1){return this._sceneStack[this._sceneStack.length-1]}else{return null}},_getPrevStack:function(){if(this._sceneStack.length>=2){return this._sceneStack[this._sceneStack.length-2]}else{return null}},_onTransitionStartEnd:function(){var e=this._getPrevStack();if(e){e.scene.onPauseAfter()}var t=this._getCurrentStack();if(t){t.scene.onResumeAfter()}},_onTransitionBackEnd:function(){var e=this._getPrevStack();if(e){e.scene.onResumeAfter()}var t=this._getCurrentStack();if(t){t.scene.onPauseAfter();t.scene.onDestroy();this._removeCurrentScene()}}});Navy.Scene=Navy.Class(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Scene",_pageStack:null,initialize:function($super,e,t){this._pageStack=[];$super(e,function(){var i=this._views;for(var n in i){i[n].setPos({z:100})}this.nextPage(e.extra.page,t.bind(null,this));i[n].addRawEventListener("touchend",function(e){e.stopPropagation();Navy.Root.nextScene("Scene1")})}.bind(this));var i=function(){if(this._pageStack.length<5){this.nextPage("Page"+(Date.now()%2+1))}else{this._element.removeEventListener("touchend",i);this._element.addEventListener("touchend",function e(){this.backPage()}.bind(this))}}.bind(this);this._element.addEventListener("touchend",i)},nextPage:function(e,t){this._createPage(e,function(e){this._addPage(e);t&&t(e)}.bind(this))},backPage:function(){if(this._pageStack.length>=2){var e=this._pageStack[this._pageStack.length-1];var t=e.transition;t.back(this._onTransitionBackEnd.bind(this))}},onCreate:function(){console.log("onCreate",this.CLASSNAME)},onResumeBefore:function(){console.log("onResumeBefore",this.CLASSNAME)},onResumeAfter:function(){console.log("onResumeAfter",this.CLASSNAME)},onPauseBefore:function(){console.log("onPauseBefore",this.CLASSNAME)},onPauseAfter:function(){console.log("onPauseAfter",this.CLASSNAME)},onDestroy:function(){console.log("onDestroy",this.CLASSNAME)},_getBottomPageLayout:function(e){var t={"class":"Navy.Page",id:"$bottom",pos:{x:0,y:0},size:{width:e.size.width,height:e.size.height},extra:{contentLayoutFile:e.extra.contentBottomLayoutFile}};return t},_getTopPageLayout:function(e){var t={"class":"Navy.Page",id:"$top",pos:{x:0,y:0,z:100},size:{width:e.size.width,height:e.size.height},extra:{contentLayoutFile:e.extra.contentTopLayoutFile}};return t},_createPage:function(e,t){var i=Navy.Config.page[e];Navy.Resource.loadScript(i.classFile,this._onLoadScript.bind(this,i,t))},_createPageByLayout:function(e,t){var i=Navy.Resource.getClass(e.class);new i(e,t)},_onLoadScript:function(e,t){var i=Navy.Resource.getClass(e.class);new i(e,t)},_addPage:function(e){e.onCreate();e.onResumeBefore();var t=this._getCurrentStack();if(t){var i=t.page;i.onPauseBefore()}var n=new Navy.Transition.SlideOver(i,e);this._pageStack.push({page:e,transition:n});this.addView(e);n.start(this._onTransitionStartEnd.bind(this))},_getCurrentStack:function(){if(this._pageStack.length>=1){return this._pageStack[this._pageStack.length-1]}else{return null}},_getPrevStack:function(){if(this._pageStack.length>=2){return this._pageStack[this._pageStack.length-2]}else{return null}},_onTransitionStartEnd:function(){var e=this._getPrevStack();if(e){e.page.onPauseAfter()}var t=this._getCurrentStack();if(t){t.page.onResumeAfter()}},_onTransitionBackEnd:function(){var e=this._getPrevStack();if(e){e.page.onResumeAfter()}var t=this._getCurrentStack();if(t){t.page.onPauseAfter();t.page.onDestroy();var i=this._pageStack.pop();i.page.destroy()}}});Navy.Transition.Transition=Navy.Class({CLASSNAME:"Navy.Transition.Transition",initialize:function(e,t){},start:function(e){},back:function(e){}});Navy.Transition.Fade=Navy.Class(Navy.Transition.Transition,{CLASSNAME:"Navy.Transition.Fade",$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(e,t){this._beforeView=e;this._afterView=t;if(!this.$static.initAnimationStyle){this._addAnimationStyle();this.$static.initAnimationStyle=true}e&&e.setRawStyle({webkitAnimation:"0.5s"});t&&t.setRawStyle({webkitAnimation:"0.5s",opacity:0})},_addAnimationStyle:function(){var e="@-webkit-keyframes fade_in  {100% {opacity: 1}}";var t="@-webkit-keyframes fade_out {100% {opacity: 0}}";var i=document.createElement("style");i.textContent=e+t;document.head.appendChild(i)},start:function(e){if(!this._beforeView){this._afterView.setRawStyle({opacity:""});e&&e();return}var t=function(){this._beforeView.hide();this._beforeView.setRawStyle({webkitAnimationName:""});this._beforeView.removeRawEventListener("webkitAnimationEnd",t);this._afterView.addRawEventListener("webkitAnimationEnd",i);this._afterView.setRawStyle({opacity:0,webkitAnimationName:"fade_in"})}.bind(this);var i=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",i);this._afterView.setRawStyle({opacity:"",webkitAnimationName:"none"});e&&e()}.bind(this);this._beforeView.addRawEventListener("webkitAnimationEnd",t);this._beforeView.setRawStyle({webkitAnimationName:"fade_out"})},back:function(e){if(!this._beforeView){e&&e();return}var t=function(){this._afterView.hide();this._afterView.removeRawEventListener("webkitAnimationEnd",t);this._afterView.setRawStyle({webkitAnimationName:"none"});this._beforeView.addRawEventListener("webkitAnimationEnd",i);this._beforeView.setRawStyle({opacity:0,webkitAnimationName:"fade_in"});this._beforeView.show()}.bind(this);var i=function(){this._beforeView.removeRawEventListener("webkitAnimationEnd",i);this._beforeView.setRawStyle({opacity:"",webkitAnimationName:"none"});e&&e()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",t);this._afterView.setRawStyle({webkitAnimationName:"fade_out"})}});Navy.Transition.SlideOver=Navy.Class(Navy.Transition.Transition,{CLASSNAME:"Navy.Transition.SlideOver",$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(e,t){this._beforeView=e;this._afterView=t;if(!this.$static.initAnimationStyle){this._addAnimationStyle();this.$static.initAnimationStyle=true}var i=Navy.Config.app.size.width;t.setRawStyle({webkitAnimation:"0.5s",webkitTransform:"translateX("+i+"px)"})},_addAnimationStyle:function(){var e=Navy.Config.app.size.width;var t="@-webkit-keyframes slide_over_in  {100% {-webkit-transform: translateX(0)}}";var i="@-webkit-keyframes slide_over_out {100% {-webkit-transform: translateX(%width%px)}}".replace("%width%",e);var n=document.createElement("style");n.textContent=t+i;document.head.appendChild(n)},start:function(e){if(!this._beforeView){this._afterView.setRawStyle({webkitTransform:"none"});e&&e();return}var t=function(){this._beforeView.hide();this._afterView.removeRawEventListener("webkitAnimationEnd",t);this._afterView.setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});e&&e()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",t);this._afterView.setRawStyle({webkitAnimationName:"slide_over_in"})},back:function(e){if(!this._beforeView){e&&e();return}var t=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",t);e&&e()}.bind(this);this._beforeView.show();this._afterView.addRawEventListener("webkitAnimationEnd",t);this._afterView.setRawStyle({webkitAnimationName:"slide_over_out"})}})}();