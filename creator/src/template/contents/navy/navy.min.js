(function(){"use strict";window.Navy={};(function(){var t=document.querySelectorAll("script");var e=t[t.length-1];if(e.dataset.assetConfig){Navy.assetConfig=JSON.parse(e.dataset.assetConfig)}else{window.Navy.assetConfig={alwaysRemote:false,forceUpdate:false}}})();window.addEventListener("DOMContentLoaded",function(){if(Navy.UnitTest){return}Navy.AssetInstaller.initialize("./manifest.json");Navy.AssetInstaller.setAlwaysRemote(Navy.assetConfig.alwaysRemote);Navy.AssetInstaller.update({forceUpdate:Navy.assetConfig.forceUpdate,onProgress:function(t,e){var i=document.querySelector("#asset_installer_inner_progress");if(i){i.style.width=100*t/e+"%"}},onComplete:function(){var t=document.querySelector("#asset_installer_progress");t&&t.parentElement.removeChild(t);Navy.App.initialize()},onError:function(t){console.error(t)}})});Navy.version="0.0.1";Navy.Class=function(t){var e;var i;var n;switch(arguments.length){case 2:n=Navy.Class._RootClass;e=arguments[0];i=arguments[1];break;case 3:if(typeof arguments[1]==="function"){n=arguments[1]}else{n=arguments[1].constructor}e=arguments[0];i=arguments[2];break;default:throw new Error("arguments of Navy.Class is 2 or 3.")}if(Navy.Class._getByReflection(e)){throw new Error("already defined this className. "+e)}var a=Navy.Class._create(e,n,i);Navy.Class._setByReflection(e,a);return a};Navy.Class.instance=function t(e){var i=Navy.Class.apply(Navy,arguments);i.__manualInitialize__=true;var n=new i;var a=arguments[0];Navy.Class._setByReflection(a,n);return n};Navy.Class._RootClass=function e(){};Navy.Class._RootClass.prototype.initialize=function(){};Navy.Class._getByReflection=function i(t){var e=t.split(".");var i=window;for(var n=0;n<e.length;n++){if(!i){return null}i=i[e[n]]}return i};Navy.Class._setByReflection=function n(t,e){var i=t.split(".");var n=window;for(var a=0;a<i.length-1;a++){if(!(i[a]in n)){n[i[a]]={}}n=n[i[a]]}n[i[a]]=e};Navy.Class._create=function a(t,e,i){var n=t.replace(/[.]/g,"$");var a=new Function("return function "+n+" () { if (typeof this.initialize === 'function' && !this.constructor.__manualInitialize__) { this.initialize.apply(this, arguments); } }")();function s(){}s.prototype=e.prototype;var r=new s;var o=new s;a.prototype=r;var l;var h;if(i.$static){for(l in i.$static){var h=i.$static[l];if(typeof h==="function"){if(Navy.Class._argumentNames(h)[0]==="$super"){h=Navy.Class._wrapFunction(e,l,h)}}a[l]=h}delete i.$static}for(l in i){h=i[l];if(typeof h==="object"&&h!==null){if(l!=="$static"){throw new Error("object property must be primitive type. property = "+l)}}if(typeof h==="function"){if(Navy.Class._argumentNames(h)[0]==="$super"){h=Navy.Class._wrapFunction(o,l,h)}}a.prototype[l]=h}a.prototype.constructor=a;a.prototype.$className=t;a.prototype.$class=a;return a};Navy.Class._argumentNames=function s(t){var e=t.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e};Navy.Class._wrapFunction=function r(t,e,i){if(typeof t[e]!=="function"){throw new Error("override method must be function. function = "+e)}return function(){var n=this;var $super=function(){return t[e].apply(n,arguments)};var a=[$super].concat(Array.prototype.slice.call(arguments,0));return i.apply(this,a)}};Navy.Class.instance("Navy.AssetInstaller",{$static:{contentType:{".js":"text/javascript",".css":"text/stylesheet",".json":"text/json",".png":"image/png",".jpg":"image/jpg",".jpeg":"image/jpg",".gif":"image/gif"}},_db:null,_manifestURL:null,_remoteManifest:null,_localManifest:null,_invalidAssets:null,_concurrency:4,_alwaysRemote:false,_totalInvalidCount:0,_doneInvalidCount:0,_callbackOnProgress:null,_callbackOnComplete:null,_callbackOnError:null,_loadAsset:null,initialize:function(t){this._localManifest={baseUrl:"",assets:[]};this.setManifestURL(t);this.setAlwaysRemote(false)},setManifestURL:function(t){this._manifestURL=t},setAlwaysRemote:function(t){this._alwaysRemote=t;if(t){this._loadAsset=this._loadRemoteAsset}else{this._loadAsset=this._loadLocalAsset}},update:function(t){this._callbackOnProgress=t.onProgress||function(){};this._callbackOnComplete=t.onComplete||function(){};this._callbackOnError=t.onError||function(){};var e=t.forceUpdate||false;if(this._alwaysRemote){setTimeout(function(){this._callbackOnComplete()}.bind(this),0);return}if(e){this._deleteAll(this._initDB.bind(this))}else{this._initDB()}},loadJavaScript:function(t,e,i){this._loadAsset(t,function(t,n,a){if(a!=="text/javascript"){throw new Error("the path is not javascript. path = "+t)}e.textContent=n;i&&i(e)})},loadJSON:function(t,e){this._loadAsset(t,function(t,i,n){if(n!=="text/json"){throw new Error("the path is not json. path = "+t)}var a=JSON.parse(i);e&&e(a)})},loadCSS:function(t,e,i){this._loadAsset(t,function(t,n,a){if(a!=="text/stylesheet"){throw new Error("the path is not css. path = "+t)}e.textContent=n;i&&i(e)})},loadImage:function(t,e,i){e.addEventListener("load",function n(){this.removeEventListener("load",n);i&&i(this)});e.addEventListener("error",function a(){this.removeEventListener("error",a);throw new Error("fail loading image. path = "+t)});this._loadAsset(t,function(t,i,n){if(n.indexOf("image/")!==0){throw new Error("the path is not image. path = "+t)}e.src=t},function(t){e.src=t},"image/*")},_loadLocalAsset:function(t,e,i,n){var a=function(n){n.executeSql("SELECT content, contentType from asset where path = ?",[t],function(n,a){var s=a.rows;if(s.length!==1){if(i){i(t);return}else{throw new Error("not found the path in DB. path = "+t)}}var r=s.item(0);var o=r.content;var l=r.contentType;e&&e(t,o,l)})};var s=function(t){console.error(t)};this._db.transaction(a,s)},_loadRemoteAsset:function(t,e,i,n){var a={path:t,contentType:n||this._getContentType(t)};var s=new Navy.AssetInstaller.Loader;s.onload=function(t,i,n){e&&e(i.path,n,i.contentType)};s.onerror=function(e,n){if(i){i(n.path)}else{throw new Error("not found the path in remote. path = "+t)}};s.load(a)},_initDB:function(){var t=function(t){t.executeSql("CREATE TABLE IF NOT EXISTS asset (path TEXT PRIMARY KEY, hash TEXT, contentType TEXT, content TEXT)")};var e=function(t){console.error(t)};var i=function(){this._loadRemoteManifest()}.bind(this);this._db=openDatabase("asset_installer","0.1","AssetInstaller",5*1e3*1e3);this._db.transaction(t,e,i)},_loadRemoteManifest:function(){var t=new XMLHttpRequest;t.open("GET",this._manifestURL);t.onload=function(t){var e=t.target;this._remoteManifest=JSON.parse(e.responseText);this._loadLocalManifest()}.bind(this);t.send()},_loadLocalManifest:function(){var t=function(t){t.executeSql("SELECT path, hash from asset",null,function(t,e){var i=e.rows;for(var n=0;n<i.length;n++){var a=i.item(n);this._localManifest.assets.push({path:a.path,hash:a.hash})}}.bind(this))}.bind(this);var e=function(t){console.error(t)};var i=function(){this._pickInvalidAssets()}.bind(this);this._db.transaction(t,e,i)},_pickInvalidAssets:function(){var t=this._manifestToAssetMap(this._localManifest);var e=this._manifestToAssetMap(this._remoteManifest);var i=[];for(var n in e){var a=e[n].hash;if(!t[n]){i.push({path:n,hash:a});continue}var s=t[n].hash;if(a!==s){i.push({path:n,hash:a})}}this._invalidAssets=i;this._totalInvalidCount=i.length;this._doneInvalidCount=0;this._startLoadingRemoteAssetsToLocal()},_startLoadingRemoteAssetsToLocal:function(){if(this._totalInvalidCount===0){this._callbackOnComplete();return}for(var t=0;t<this._concurrency;t++){var e=new Navy.AssetInstaller.Loader;e.onload=this._onLoadRemoteAssetToLocal.bind(this);e.onerror=this._onLoadRemoteAssetErrorToLocal.bind(this);this._loadRemoteAssetToLocal(e)}},_loadRemoteAssetToLocal:function(t){if(this._invalidAssets.length===0){if(this._doneInvalidCount===this._totalInvalidCount){this._callbackOnComplete()}return}var e=this._invalidAssets.shift();var i=e.path;e.contentType=e.contentType||this._getContentType(i);t.load(e)},_onLoadRemoteAssetToLocal:function(t,e,i){this._saveRemoteAsset(t,e,i)},_onLoadRemoteAssetErrorToLocal:function(t,e){console.error(e);this._callbackOnError(e.path)},_saveRemoteAsset:function(t,e,i){function n(t){var n=e.path;var a=e.hash;var s=e.contentType;var r=i||null;t.executeSql("INSERT OR REPLACE INTO asset (path, hash, contentType, content) VALUES (?, ?, ?, ?)",[n,a,s,r])}var a=function(t){console.error(t,e);this._callbackOnError(e.path)}.bind(this);var s=function(){this._doneInvalidCount++;this._callbackOnProgress(this._doneInvalidCount,this._totalInvalidCount);this._loadRemoteAssetToLocal(t)}.bind(this);this._db.transaction(n,a,s)},_deleteAll:function(t){var e=function(t){t.executeSql("DROP TABLE IF EXISTS asset")};var i=function(t){console.error(t)};var n=function(){t&&t()}.bind(this);var a=openDatabase("asset_installer","0.1","AssetInstaller",5*1e3*1e3);a.transaction(e,i,n)},_manifestToAssetMap:function(t){var e=t.assets;var i={};for(var n=0;n<e.length;n++){i[e[n].path]=e[n]}return i},_getContentType:function(t){var e=t.lastIndexOf(".");var i=t.substr(e).toLowerCase();var n=this.$class.contentType[i];if(!n){throw new Error("unknown file extension. "+i)}return n}});Navy.Class("Navy.AssetInstaller.Loader",{onload:null,onerror:null,_asset:null,_loaderElement:null,load:function(t){this._asset=t;var e=t.path;var i=t.contentType;if(i.indexOf("text/")===0){var n=new XMLHttpRequest;n.open("GET",e,true);n.onload=this._onLoad.bind(this);n.onerror=this._onError.bind(this);n.onabort=this._onError.bind(this);n.send();this._loaderElement=n}else if(i.indexOf("image/")===0){var a=new Image;a.onload=this._onLoad.bind(this);a.onerror=this._onError.bind(this);a.onabort=this._onError.bind(this);a.src=e;this._loaderElement=a}else{throw new Error("unknown content type. "+i)}},_onLoad:function(){if(!this.onload){return}if("responseText"in this._loaderElement){var t=this._loaderElement.status||200;if(t===200){var e=this._loaderElement.responseText;this.onload(this,this._asset,e)}else{this._onError()}}else{this.onload(this,this._asset)}},_onError:function(){if(!this.onerror){return}this.onerror(this,this._asset)}});Navy.Class("Navy.Notify",{_count:null,_callback:null,initialize:function(t,e){if(arguments.length===2){this.set(t,e)}},pass:function(){this._count--;if(this._count===0){this._execCallback()}},set:function(t,e){this._count=t;this._callback=e;if(t===0){this._execCallback()}},_execCallback:function(){setTimeout(this._callback,0)}});Navy.Class.instance("Navy.URL",{parseHash:function(t){var e={};var i=t.match(/#(.*)/);if(!i){return e}var n=i[1].split("&");for(var a=0;a<n.length;a++){var s=n[a];var r=s.split("=")[0];var o=s.split("=")[1];e[r]=o}return e},stringifyHash:function(t){var e=[];for(var i in t){e.push(i+"="+t[i])}if(e.length){return"#"+e.join("&")}else{return""}}});Navy.Class.instance("Navy.App",{_initRootBeforeCallback:null,initialize:function(){Navy.History.initialize();Navy.Asset.initialize();Navy.Config.initialize(this._onInitConfig.bind(this))},setInitRootBeforeCallback:function(t){this._initRootBeforeCallback=t},_onInitConfig:function(){this._initRootBeforeCallback&&this._initRootBeforeCallback();Navy.Root.initialize()}});Navy.Class.instance("Navy.Asset",{_scriptFileMap:null,initialize:function(){this._scriptFileMap={}},loadLayout:function(t,e){Navy.AssetInstaller.loadJSON(t,e)},loadJSON:function(t,e){Navy.AssetInstaller.loadJSON(t,e)},loadScript:function(t,e){if(this._scriptFileMap[t]){setTimeout(e,0);return}this._scriptFileMap[t]=true;var i=document.createElement("script");document.head.appendChild(i);Navy.AssetInstaller.loadJavaScript(t,i,e)},loadImage:function(t,e,i){Navy.AssetInstaller.loadImage(e,t||new Image,i)},getClass:function(t){var e=t.split(".");var i=window;for(var n=0;n<e.length;n++){i=i[e[n]]}return i}});Navy.Class.instance("Navy.Config",{app:null,scene:null,page:null,initialize:function(t){var e=new Navy.Notify(3,t);var i=e.pass.bind(e);Navy.Asset.loadJSON("config/app.json",function(t){this.app=t;i()}.bind(this));Navy.Asset.loadJSON("config/scene.json",function(t){this.scene=this._arrayToMap(t);i()}.bind(this));Navy.Asset.loadJSON("config/page.json",function(t){this.page=this._arrayToMap(t);i()}.bind(this))},_arrayToMap:function(t){var e={};for(var i=0;i<t.length;i++){e[t[i].id]=t[i]}return e}});Navy.Class("Navy.Event",{target:null,data:null,_defaultCallbacks:null,_preventedDefault:false,_preventedPropagation:false,initialize:function(t,e){this.target=t;this.data=e;this._defaultCallbacks=[]},addDefaultCallback:function(t){this._defaultCallbacks.push(t)},getDefaultCallbacks:function(){return[].concat(this._defaultCallbacks)},preventDefault:function(){this._preventedDefault=true},isPreventedDefault:function(){return this._preventedDefault},preventPropagation:function(){this._preventedPropagation=true},isPreventedPropagation:function(){return this._preventedPropagation}});Navy.Class("Navy.EventTarget",{_eventCallbackMap:null,_eventCallbackId:0,initialize:function(){this._eventCallbackMap={}},on:function(t,e){if(!this._eventCallbackMap[t]){this._eventCallbackMap[t]=[]}var i=this._eventCallbackId++;this._eventCallbackMap[t].push({callbackId:i,callback:e});return i},off:function(t,e){var i=this._eventCallbackMap[t];if(!i){return}if(typeof e==="function"){var n=e;for(var a=0;a<i.length;a++){if(n===i[a].callback){i.splice(a,1);a--}}}else{var s=e;for(var a=0;a<i.length;a++){if(s===i[a].callbackId){i.splice(a,1);return}}}},trigger:function(t,e,i,n){if(!i){i=new Navy.Event(this,e)}var a="on"+t;if(this[a]&&typeof this[a]==="function"){this[a](i)}var s=this._eventCallbackMap[t];if(s){for(var r=0;r<s.length;r++){if(i.isPreventedPropagation()){break}var o=s[r].callback;o.call(this,i)}}if(!i.isPreventedDefault()){n&&n.call(this,i);var l=i.getDefaultCallbacks();for(var r=0;r<l.length;r++){l[r].call(this,i)}}}});Navy.Class.instance("Navy.History",{HASH_KEY:"history",_hashChangeEventBySelf:false,initialize:function(){this._changeHash(0,true);window.addEventListener("hashchange",this._onHashChange.bind(this))},forwarded:function(){this._changeHash(1)},backed:function(){this._hashChangeEventBySelf=true;window.history.back()},_changeHash:function(t,e){this._hashChangeEventBySelf=true;var i=Navy.URL.parseHash(location.href);var n=parseInt(i[this.HASH_KEY],10);if(e){n=t}else{n+=t}i[this.HASH_KEY]=n;i=Navy.URL.stringifyHash(i);location.assign(i)},_back:function(t){var e=Navy.Root.getCurrentScene();if(e.getPageStackCount()>=2){e.backPage(t);return}if(Navy.Root.getSceneStackCount()>=2){Navy.Root.backScene(t)}},_onHashChange:function(t){if(this._hashChangeEventBySelf){this._hashChangeEventBySelf=false;return}this._hashChangeEventBySelf=false;var e=this.backed;this.backed=function(){};var i=Navy.URL.parseHash(t.oldURL);var n=Navy.URL.parseHash(t.newURL);var a=parseInt(i[this.HASH_KEY],10);var s=parseInt(n[this.HASH_KEY],10);if(a>s){this._back()}this.backed=e}});Navy.Class("Navy.View.View",Navy.EventTarget,{SIZE_POLICY_FIXED:"fixed",SIZE_POLICY_WRAP_CONTENT:"wrapContent",SIZE_POLICY_MATCH_PARENT:"matchParent",_id:null,_page:null,_scene:null,_layout:null,_element:null,_parentView:null,_tapGesture:null,initialize:function($super,t,e){$super();this._preventDOMEvent=this._preventDOMEvent.bind(this);if(t){this._id=t.id}this._layout=t;this._createElement(t);this._createExtraElement(t);this.setLayout(t,e)},setLayout:function(t,e){if(!t){return}function i(){var e=new Navy.Notify(2,n.bind(this));var i=e.pass.bind(e);this._applyLayout(t,i);this._applyExtraLayout(t,i)}function n(){this._updateSizeWithWrapContentSize();e&&e(this)}this._layout=t;var a=new Navy.Notify(2,i.bind(this));var s=a.pass.bind(a);this._loadAsset(t,s);this._loadExtraAsset(t,s)},getLayout:function(){return this._cloneObject(this._layout)},lockView:function(){this._element.addEventListener("touchstart",this._preventDOMEvent,true)},unlockView:function(){this._element.removeEventListener("touchstart",this._preventDOMEvent,true)},_preventDOMEvent:function(t){t.stopPropagation();t.preventDefault()},_createElement:function(t){this._element=document.createElement("div");this._element.style.visibility="hidden";this._tapGesture=new Navy.Gesture.Tap(this._element,this._onTap.bind(this));this._tapGesture.start()},_applyLayout:function(t,e){this._element.style.position="absolute";this.setVisible(t.visible);this.setPos(t.pos);this.setSizePolicy(t.sizePolicy,true);this.setSize(t.size);this.setBackgroundColor(t.backgroundColor);this.setBorder(t.border);this.setPadding(t.padding);this.setLink(t.link);this._setRawStyle({overflow:"hidden"});e&&setTimeout(e,0)},_loadAsset:function(t,e){e&&setTimeout(e,0)},_createExtraElement:function(t){},_applyExtraLayout:function(t,e){e&&setTimeout(e,0)},_loadExtraAsset:function(t,e){e&&setTimeout(e,0)},_calcWrapContentSize:function(){return{width:0,height:0}},_updateSizeWithWrapContentSize:function(){var t=false;var e;if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT||this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){e=this._calcWrapContentSize()}if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT){this._element.style.width=e.width+"px";t=true}if(this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){this._element.style.height=e.height+"px";t=true}if(t){this.trigger("SizeChanged")}},_setRawStyle:function(t){var e="";for(var i in t){var n=t[i];if(n!==undefined){var a=i.replace(/([A-Z])/g,"-$1").toLowerCase();if(a.indexOf("webkit")===0){a="-"+a}if(n===""){this._element.style[i]=""}else{e+=a+":"+n+";"}}}this._element.style.cssText+=e},_onTap:function(){this.trigger("Tap",null,null,this._onTapDefault.bind(this))},_onTapDefault:function(){if(!this._layout.link||!this._layout.link.id){return}var t=this._layout.link.id;this.trigger("Link",{linkId:t},null,this._onLinkDefault.bind(this))},_onLinkDefault:function(t){var e=t.data.linkId;var i=e.split("/");var n=i[0];var a=i[1];switch(n){case"page":this.getScene().linkPage(a,t.data);break;case"scene":Navy.Root.linkScene(a,t.data);break}},addRawEventListener:function(t,e){this._element.addEventListener(t,e)},removeRawEventListener:function(t,e){this._element.removeEventListener(t,e)},getId:function(){return this._id},setPage:function(t){this._page=t},getPage:function(){return this._page},setScene:function(t){this._scene=t},getScene:function(){return this._scene},getElement:function(){return this._element},setParent:function(t){this._parentView=t},getParent:function(){return this._parentView},destroy:function(){this._parentView.removeView(this);var t=Object.getOwnPropertyNames(this);for(var e=0;e<t.length;e++){this[t[e]]=null}},toJSON:function(){return this._layout},_cloneObject:function(t){return JSON.parse(JSON.stringify(t))},isVisible:function(){if(!this._layout.visible){return false}for(var t=this.getParent();t;t=t.getParent()){if(!t.isVisible()){return false}}return true},setVisible:function(t){this._layout.visible=t;if(t){this._element.style.visibility=""}else{this._element.style.visibility="hidden"}},setBackgroundColor:function(t){this._layout.backgroundColor=t;this._element.style.backgroundColor=t},getBackgroundColor:function(){return this._layout.backgroundColor},setBorder:function(t){this._layout.border=t;this._element.style.border=t},getBorder:function(){return this._layout.border},getBorderSize:function(){var t={left:0,top:0,right:0,bottom:0};var e=this._element.style;if(e.borderLeftStyle!=="hidden"&&e.borderLeftStyle!=="none"){t.left=parseInt(e.borderLeftWidth,10)||0}if(e.borderRightStyle!=="hidden"&&e.borderRightStyle!=="none"){t.right=parseInt(e.borderRightWidth,10)||0}if(e.borderTopStyle!=="hidden"&&e.borderTopStyle!=="none"){t.top=parseInt(e.borderTopWidth,10)||0}if(e.borderBottomStyle!=="hidden"&&e.borderBottomStyle!=="none"){t.bottom=parseInt(e.borderBottomWidth,10)||0}return t},setPadding:function(t){this._layout.padding=t;this._element.style.padding=t},getPadding:function(){return this._layout.padding},getPaddingSize:function(){var t={};var e=this._element.style;t.left=parseInt(e.paddingLeft,10)||0;t.top=parseInt(e.paddingTop,10)||0;t.right=parseInt(e.paddingRight,10)||0;t.bottom=parseInt(e.paddingBottom,10)||0;return t},setSizePolicy:function(t,e){this._layout.sizePolicy=t;switch(t.width){case this.SIZE_POLICY_FIXED:break;case this.SIZE_POLICY_WRAP_CONTENT:if(!e){this._updateSizeWithWrapContentSize()}break;case this.SIZE_POLICY_MATCH_PARENT:this._element.style.width="100%";break;default:throw new Error("unknown size policy width. "+this._layout.sizePolicy.width)}switch(t.height){case this.SIZE_POLICY_FIXED:break;case this.SIZE_POLICY_WRAP_CONTENT:if(!e){this._updateSizeWithWrapContentSize()}break;case this.SIZE_POLICY_MATCH_PARENT:this._element.style.height="100%";break;default:throw new Error("unknown size policy height. "+this._layout.sizePolicy.height)}},getSizePolicy:function(){return this._cloneObject(this._layout.sizePolicy)},getSize:function(){var t,e;switch(this._layout.sizePolicy.width){case this.SIZE_POLICY_FIXED:t=this._layout.size.width;break;case this.SIZE_POLICY_WRAP_CONTENT:t=this._element.offsetWidth;break;case this.SIZE_POLICY_MATCH_PARENT:t=this._element.offsetWidth;break;default:throw new Error("unknown size policy width. "+this._layout.sizePolicy.width)}switch(this._layout.sizePolicy.height){case this.SIZE_POLICY_FIXED:e=this._layout.size.height;break;case this.SIZE_POLICY_WRAP_CONTENT:e=this._element.offsetHeight;break;case this.SIZE_POLICY_MATCH_PARENT:e=this._element.offsetHeight;break;default:throw new Error("unknown size policy height. "+this._layout.sizePolicy.height)}return{width:t,height:e}},setSize:function(t){if(!t){return}if(!this._layout.size){this._layout.size={}}if(this._layout.sizePolicy.width===this.SIZE_POLICY_FIXED){if(typeof t.width==="number"){this._layout.size.width=t.width;this._element.style.width=t.width+"px"}}if(this._layout.sizePolicy.height===this.SIZE_POLICY_FIXED){if(typeof t.height==="number"){this._layout.size.height=t.height;this._element.style.height=t.height+"px"}}this.trigger("SizeChanged")},setPos:function(t){var e="";if(typeof t.x==="number"){var i=parseInt(t.x,10);this._layout.pos.x=i;e+="left:"+i+"px;"}if(typeof t.y==="number"){var n=parseInt(t.y,10);this._layout.pos.y=n;e+="top:"+n+"px;"}if(typeof t.z==="number"){var a=parseInt(t.z,10);this._layout.pos.z=a;e+="z-index:"+a+";"}this._element.style.cssText+=e;this.trigger("PosChanged")},addPos:function(t){var e=this._layout.pos.x+(t.x||0);var i=this._layout.pos.y+(t.y||0);this.setPos({x:e,y:i})},getPos:function(){return this._cloneObject(this._layout.pos)},setLink:function(t){this._layout.link=t},getLink:function(){return this._cloneObject(this._layout.link)}});Navy.Class("Navy.View.Image",Navy.View.View,{_imgElm:null,initialize:function($super,t,e){$super(t,e)},_createExtraElement:function($super,t){$super(t);var e=document.createElement("img");this._element.appendChild(e);this._imgElm=e},_applyExtraLayout:function($super,t,e){$super(t,e)},_loadExtraAsset:function($super,t,e){if(t&&t.extra.src){this.setSrc(t.extra.src,function(){$super(t,e)})}else{$super(t,e)}},_calcWrapContentSize:function(){var t=this.getBorderSize();var e=this.getPaddingSize();return{width:this._imgElm.width+t.left+t.right+e.left+e.right,height:this._imgElm.height+t.top+t.bottom+e.top+e.bottom}},_onLoadImage:function(t,e,i){this.trigger("SizeChanged")},setSrc:function(t,e){this._layout.extra.src=t;Navy.Asset.loadImage(this._imgElm,t,function(t,i,n){this._onLoadImage(t,i,n);e&&e()}.bind(this))},getSrc:function(){return this._layout.src}});Navy.Class("Navy.View.Text",Navy.View.View,{_textElement:null,initialize:function($super,t,e){$super(t,e)},_createExtraElement:function($super,t){$super(t);this._textElement=document.createElement("span");this._textElement.style.display="inline-block";this._textElement.style.lineHeight="normal";this._element.appendChild(this._textElement)},_applyExtraLayout:function($super,t,e){if(!t.extra){return}this.setFontSize(t.extra.fontSize);this.setFontColor(t.extra.fontColor);this.setTextAlign(t.extra.textAlign);$super(t,e)},_loadExtraAsset:function($super,t,e){this.setText(t.extra.text);$super(t,e)},_calcWrapContentSize:function(){var t=this.getBorderSize();var e=this.getPaddingSize();return{width:this._textElement.offsetWidth+t.left+t.right+e.left+e.right,height:this._textElement.offsetHeight+t.top+t.bottom+e.top+e.bottom}},setSize:function($super,t){$super(t);this._element.style.lineHeight=this._element.clientHeight+"px"},setText:function(t){this._layout.extra.text=t;this._textElement.textContent=t;if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT||this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){this._updateSizeWithWrapContentSize();this.trigger("SizeChanged")}},getText:function(){return this._layout.extra.text},setFontSize:function(t){this._layout.extra.fontSize=t;this._element.style.fontSize=t+"px";if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT||this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){this._updateSizeWithWrapContentSize();this.trigger("SizeChanged")}},getFontSize:function(){return this._layout.extra.fontSize},setFontColor:function(t){this._layout.extra.fontColor=t;this._element.style.color=t},getFontColor:function(){return this._layout.extra.fontColor},setTextAlign:function(t){this._layout.extra.textAlign=t;if(t){this._element.style.textAlign=t.horizontal;this._textElement.style.verticalAlign=t.vertical}},getTextAlign:function(){return this._cloneObject(this._layout.extra.textAlign)}});Navy.Class("Navy.View.TextEdit",Navy.View.View,{_textElement:null,initialize:function($super,t,e){$super(t,e)},_createExtraElement:function($super,t){$super(t);this._textElement=document.createElement("input");this._textElement.style.cssText="-webkit-user-select:auto; width: 100%; height:100%; box-sizing:border-box; border:none;";this._element.appendChild(this._textElement)},_loadExtraAsset:function($super,t,e){this.setText(t.extra.text);$super(t,e)},_calcWrapContentSize:function(){return{width:this._textElement.offsetWidth,height:this._textElement.offsetHeight}},_applyExtraLayout:function($super,t,e){if(!t.extra){return}this.setFontSize(t.extra.fontSize);this.setFontColor(t.extra.fontColor);this.setPlaceholder(t.extra.placeholder);this.setTextType(t.extra.textType);$super(t,e)},setText:function(t){this._layout.extra.text=t;this._textElement.value=t;if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT||this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){this._updateSizeWithWrapContentSize();this.trigger("SizeChanged")}},getText:function(){return this._textElement.value},setFontSize:function(t){this._layout.extra.fontSize=t;this._textElement.style.fontSize=t+"px";if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT||this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){this._updateSizeWithWrapContentSize();this.trigger("SizeChanged")}},getFontSize:function(){return this._layout.extra.fontSize},setFontColor:function(t){this._layout.extra.fontColor=t;this._textElement.style.color=t},getFontColor:function(){return this._layout.extra.fontColor},getPlaceholder:function(){return this._layout.extra.placeHolder},setPlaceholder:function(t){this._textElement.placeholder=t;this._layout.extra.placeholder=t},setTextType:function(t){this._layout.extra.textType=t;this._textElement.type=t},getTextType:function(){return this._layout.extra.textType}});Navy.Class("Navy.ViewGroup.ViewGroup",Navy.View.View,{_views:null,_viewsOrder:null,_initCallback:null,_contentLayouts:null,_wrapContentSizeView:null,initialize:function($super,t,e){this._views={};this._viewsOrder=[];this._wrapContentSizeView={widthView:null,heightView:null};$super(t,e)},_loadExtraAsset:function($super,t,e){if(t&&t.extra.contentLayoutFile){this._layout.extra.contentLayoutFile=t.extra.contentLayoutFile;Navy.Asset.loadLayout(t.extra.contentLayoutFile,function(i){this._contentLayouts=i.layouts;$super(t,e)}.bind(this))}else{this._layout&&(this._layout.extra.contentLayoutFile=null);$super(t,e)}},_applyExtraLayout:function($super,t,e){if(!this._contentLayouts){$super(t,e);return}var i=this._contentLayouts;var n=new Navy.Notify(i.length,function(){$super(t,e)});var a=n.pass.bind(n);for(var s=0;s<i.length;s++){var r=i[s];var o=Navy.Asset.getClass(r.class);var l=new o(r,a);this.addView(l)}},_onLoadContentLayout:function(t){var e=new Navy.Notify(t.length,this._initCallback);var i=e.pass.bind(e);for(var n=0;n<t.length;n++){var a=t[n];var s=Navy.Asset.getClass(a.class);var r=new s(a,i);this.addView(r)}},_resizeWrapContentByChangedView:function(t){if(this._layout.sizePolicy.width!==this.SIZE_POLICY_WRAP_CONTENT&&this._layout.sizePolicy.height!==this.SIZE_POLICY_WRAP_CONTENT){return}var e=t.target;var i=e.getSizePolicy();var n,a,s;if(i.width!==this.SIZE_POLICY_MATCH_PARENT||i.height!==this.SIZE_POLICY_MATCH_PARENT){n=this.getSize();a=e.getPos();s=e.getSize()}if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT){if(i.width!==this.SIZE_POLICY_MATCH_PARENT){if(a.x+s.width>n.width){this._wrapContentSizeView.widthView=e;this._element.style.width=a.x+s.width+"px"}}}if(this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){if(i.height!==this.SIZE_POLICY_MATCH_PARENT){if(a.y+s.height>n.height){this._wrapContentSizeView.heightView=e;this._element.style.height=a.y+s.height+"px"}}}},_resizeWrapContentByRemovedView:function(t){if(this._layout.sizePolicy.width!==this.SIZE_POLICY_WRAP_CONTENT&&this._layout.sizePolicy.height!==this.SIZE_POLICY_WRAP_CONTENT){return}if(this._wrapContentSizeView.widthView!==t&&this._wrapContentSizeView.heightView!==t){return}var e=this._calcWrapContentSize();if(this._layout.sizePolicy.width===this.SIZE_POLICY_WRAP_CONTENT){this._element.style.width=e.width+"px"}if(this._layout.sizePolicy.height===this.SIZE_POLICY_WRAP_CONTENT){this._element.style.height=e.height+"px"}},_calcWrapContentSize:function(){var t=0;var e=0;var i;var n;var a=this._views;for(var s in a){var r=a[s];var o=r.getSizePolicy();if(o.width===this.SIZE_POLICY_MATCH_PARENT&&o.height===this.SIZE_POLICY_MATCH_PARENT){continue}var l=r.getPos();var h=r.getSize();if(o.width!==this.SIZE_POLICY_MATCH_PARENT){if(t<l.x+h.width){t=l.x+h.width;i=r}}if(o.height!==this.SIZE_POLICY_MATCH_PARENT){if(e<l.y+h.height){e=l.y+h.height;n=r}}}var _=this.getBorderSize();var u=this.getPaddingSize();return{width:t+_.left+_.right+u.left+u.right,height:e+_.top+_.bottom+u.top+u.bottom}},destroy:function($super){for(var t in this._views){var e=this._views[t];e.destroy()}$super()},setPage:function($super,t){$super(t);var e=this._views;for(var i in e){var n=e[i];n.setPage(t)}},setScene:function($super,t){$super(t);var e=this._views;for(var i in e){var n=e[i];n.setScene(t)}},findViewById:function(t){var e=t.split(".");var i=this._views[e[0]]||null;if(i){if(e.length===1){return i}else{e.shift();return i.findViewById(e.join("."))}}var n=this._views;for(var a in n){var i=n[a];if(i.findViewById){var s=i.findViewById(t);if(s){return s}}}return null},findViewByElement:function(t){var e=this._views;for(var i in e){var n=e[i];if(n.getElement()===t){return n}if(n.findViewByElement){var a=n.findViewByElement(t);if(a){return a}}}return null},getAllViews:function(){var t={};for(var e in this._views){t[e]=this._views[e]}return t},addView:function(t,e){var i=t.getElement();if(e){this._element.insertBefore(i,e.getElement())}else{this._element.appendChild(i)}this._views[t.getId()]=t;this._viewsOrder.push(t.getId());t.setParent(this);t.setPage(this.getPage());t.setScene(this.getScene());t.on("SizeChanged",this._resizeWrapContentByChangedView.bind(this));t.on("PosChanged",this._resizeWrapContentByChangedView.bind(this))},removeView:function(t){var e=t.getElement();this._element.removeChild(e);this._views[t.getId()]=null;delete this._views[t.getId()];this._viewsOrder.splice(this._viewsOrder.indexOf(t.getId()),1);t.setParent(null);this._resizeWrapContentByRemovedView(t)},removeAllViews:function(){var t=this._views;var e=Object.keys(t);for(var i=0;i<e.length;i++){var n=e[i];var a=t[n];this.removeView(a)}}});Navy.Class("Navy.ViewGroup.Button",Navy.ViewGroup.ViewGroup,{_imageView:null,_textView:null,initialize:function($super,t,e){$super(t,e)
},_createExtraElement:function($super,t){$super(t);this._element.addEventListener("touchstart",this._onTouchStart.bind(this));this._element.addEventListener("touchend",this._onTouchEnd.bind(this))},_loadExtraAsset:function($super,t,e){$super(t,e)},_applyExtraLayout:function($super,t,e){function i(){var i=this._imageView.getSize();this._textView.setSizePolicy({width:this.SIZE_POLICY_FIXED,height:this.SIZE_POLICY_FIXED});this._textView.setSize(i);this._textView.getElement().style.lineHeight=i.height+"px";this._textView.getElement().style.textAlign="center";$super(t,e)}if(this._imageView){this.removeView(this._imageView)}if(this._textView){this.removeView(this._textView)}var n=new Navy.Notify(2,i.bind(this));var a=n.pass.bind(n);var s={};s.id="image";s.visible=true;s.pos={x:0,y:0};s.sizePolicy={width:this.SIZE_POLICY_WRAP_CONTENT,height:this.SIZE_POLICY_WRAP_CONTENT};s.extra=this._cloneObject(t.extra);s.extra.src=t.extra.normal.src;this._imageView=new Navy.View.Image(s,a);this.addView(this._imageView);var r={};r.id="text";r.visible=true;r.pos={x:0,y:0};r.sizePolicy={width:this.SIZE_POLICY_WRAP_CONTENT,height:this.SIZE_POLICY_WRAP_CONTENT};r.extra=this._cloneObject(t.extra);this._textView=new Navy.View.Text(r,a);this.addView(this._textView)},_onTouchStart:function(){if(!this._layout.extra.active.src){return}this._imageView.setSrc(this._layout.extra.active.src)},_onTouchEnd:function(){if(!this._layout.extra.normal.src){return}setTimeout(function(){this._imageView.setSrc(this._layout.extra.normal.src)}.bind(this),100)}});Navy.Class("Navy.ViewGroup.ListView",Navy.ViewGroup.ViewGroup,{initialize:function($super,t,e){$super(t,e)},_applyExtraLayout:function($super,t,e){$super(t,e);this._element.style.overflowY="scroll";this._element.style.overflowX="hidden";this._element.style.webkitOverflowScrolling="touch";if(this._layout.extra.mock){var i=[];for(var n=0;n<30;n++){i.push({})}this.setItems(i)}},clear:function(){for(var t in this._views){var e=this._views[t];this.removeView(e)}},setItems:function(t,e){this.clear();this.insertItems(t,0,e)},addItems:function(t,e){this.insertItems(t,this._viewsOrder.length,e)},insertItems:function(t,e,i){if(e<0||e>this._viewsOrder.length){throw new Error("out of range. index = "+e)}if(e===this._viewsOrder.length){var n=null}else{var a=this._viewsOrder[e];var n=this.findViewById(a)}var s=new Navy.Notify(t.length,function(){var e=this._cloneObject(this._layout.extra.itemLink||"");var n=this._layout.extra.itemLayoutMargin+"px";for(var a=0;a<t.length;a++){var s=l[a];var r=t[a];if(e){s.setLink(e)}var h=false;if(i){h=i(r,s,a,o+a)}if(h===false){for(var _ in r){var u=s.findViewById(_);if(!u){continue}if(u.setText){u.setText(r[_])}else if(u.setSrc){u.setSrc(r[_])}}}s.getElement().style.position="relative";s.getElement().style.marginBottom=n;s.setVisible(true)}}.bind(this));var r=s.pass.bind(s);var o=this._viewsOrder.length;var l=[];for(var h=0;h<t.length;h++){var _={id:"item"+(o+h),visible:false,sizePolicy:{width:"wrapContent",height:"wrapContent"},pos:{x:0,y:0},extra:{contentLayoutFile:this._layout.extra.itemLayoutFile}};var u=new Navy.ViewGroup.ViewGroup(_,r);this.addView(u,n);l.push(u)}}});Navy.Class("Navy.ViewGroup.Tab",Navy.ViewGroup.ViewGroup,{_tabLabels:null,_tabContents:null,_applyExtraLayout:function($super,t,e){$super(t,e);this.removeAllViews();this._tabLabels=[];this._tabContents=[];var i=t.extra.contents;var n=new Navy.Notify(i.length*2,function(){this._adjustPosition();$super(t,e)}.bind(this));var a=n.pass.bind(n);for(var s=0;s<i.length;s++){var r=this._generateTabLabelLayout(s);var o=new Navy.ViewGroup.Button(r,a);this.addView(o);this._tabLabels.push(o);var l=this._generateTabContentLayout(s);var h=new Navy.ViewGroup.ViewGroup(l,a);this.addView(h);this._tabContents.push(h);o.on("Tap",this._onTapTabLabel.bind(this,h))}},_generateTabLabelLayout:function(t){var e=this._layout.extra.contents;var i=e[t];var n=this._cloneObject(this._layout.extra.label);n.text=i.label;var a={id:"$tab_label"+t,visible:true,sizePolicy:{width:"wrapContent",height:"wrapContent"},pos:{x:0,y:0},extra:n};return a},_generateTabContentLayout:function(t){var e=this._layout.extra.contents;var i=e[t];var n={id:i.id,visible:t===0,sizePolicy:{width:"wrapContent",height:"wrapContent"},pos:{x:0,y:0},extra:{contentLayoutFile:i.layoutFile}};return n},_adjustPosition:function(){var t=this._tabLabels[0].getSize();var e=Math.floor(this.getSize().width/this._tabLabels.length);var i=(e-t.width)/2;for(var n=0;n<this._tabLabels.length;n++){var a=this._tabLabels[n];var s=a.getPos();var r=e*n+i;s.x=r;a.setPos(s)}var o=t.height;for(var n=0;n<this._tabContents.length;n++){var l=this._tabContents[n];var s=l.getPos();s.y=o;l.setPos(s)}},_onTapTabLabel:function(t,e){var i=this._layout.extra.contents;for(var n=0;n<i.length;n++){var a=i[n].id;this.findViewById(a).setVisible(false)}t.setVisible(true)}});Navy.Class("Navy.Page",Navy.ViewGroup.ViewGroup,{initialize:function($super,t,e){$super(t,e)},setLayout:function($super,t,e){t.visible=true;t.pos={x:0,y:0};t.sizePolicy={width:this.SIZE_POLICY_FIXED,height:this.SIZE_POLICY_FIXED};t.size={width:Navy.Config.app.size.width,height:Navy.Config.app.size.height};$super(t,e)},setPage:function($super,t){},getPage:function(){return this},onCreate:function(){},onResumeBefore:function(){},onResumeAfter:function(){},onPauseBefore:function(){},onPauseAfter:function(){},onDestroy:function(){}});Navy.Class.instance("Navy.Root",Navy.ViewGroup.ViewGroup,{_sceneStack:null,_loadingElement:null,_loadingCount:0,initialize:function($super){$super();this._id="$root";this._layout={visible:true,sizePolicy:{width:this.SIZE_POLICY_FIXED,height:this.SIZE_POLICY_FIXED},size:{width:Navy.Config.app.size.width,height:Navy.Config.app.size.height},pos:{x:0,y:0}};this._initDocument();this._initLoading();var t=document.createElement("div");t.style.cssText="position:absolute; width:100%; height:100%; overflow:hidden;";document.body.appendChild(t);this._element=t;this._sceneStack=[];var e=Navy.Config.app.start.scene;this.nextScene(e)},getCurrentScene:function(){var t=this._getCurrentStack();return t.scene},getSceneStackCount:function(){return this._sceneStack.length},getCurrentPage:function(){var t=this.getCurrentScene();return t.getCurrentPage()},linkScene:function(t,e){if(t==="$back"){this.backScene(e)}else{this.nextScene(t,e)}},nextScene:function(t,e){this.lockView();this._createScene(t,function(t){this._addScene(t,e)}.bind(this))},backScene:function(t){if(this._sceneStack.length>=2){this.lockView();Navy.History.backed();var e=this._getPrevStack();e.scene.trigger("ResumeBefore",t);var i=this._getCurrentStack();i.scene.trigger("PauseBefore");i.transition.back(this._onTransitionBackEnd.bind(this))}},startLoading:function(){if(this._loadingCount===0){document.body.appendChild(this._loadingElement);this._loadingElement.addEventListener("touchstart",this._preventDOMEvent,true)}this._loadingCount++},stopLoading:function(){if(this._loadingCount===0){return}this._loadingCount--;if(this._loadingCount===0){document.body.removeChild(this._loadingElement);this._loadingElement.removeEventListener("touchstart",this._preventDOMEvent,true)}},_initDocument:function(){var t=document.createElement("title");t.textContent=Navy.Config.app.name;document.head.appendChild(t);var e=document.createElement("link");e.rel="apple-touch-icon";e.href=Navy.Config.app.touchIcon;document.head.appendChild(e);var i="";i+="* {margin:0; padding:0; -webkit-user-select: none; -webkit-user-drag:none; box-sizing: border-box;}";i+="html {width:100%; height:100%}";i+="body {background-color:#000; font-family: {fontFamily}}".replace("{fontFamily}",Navy.Config.app.fontFamily);var n=document.createElement("style");n.textContent=i;document.head.appendChild(n);var a=Navy.Config.app.size.width;var s=Navy.Config.app.size.height;var r=window.innerWidth;var o=window.innerHeight;var l=r/a;var h=o/s;var _=Math.min(l,h);var u=(r-_*a)/2;var c=(o-_*s)/2;document.body.style.position="absolute";document.body.style.zoom=_;document.body.style.width=a+"px";document.body.style.height=s+"px";document.body.style.left=u/_+"px";document.body.style.top=c/_+"px"},_initLoading:function(){var t=Navy.Config.app.size.width;var e=Navy.Config.app.size.height;var i=document.createElement("div");i.style.cssText="position: absolute; top:0; left:0; background: rgba(0,0,0,0.5)";i.style.width=t+"px";i.style.height=e+"px";this._loadingElement=i;if(Navy.Config.app.loading.src){var n=document.createElement("img");Navy.Asset.loadImage(n,Navy.Config.app.loading.src,function(n){var a=t*.15;n.width=a;n.style.left=t/2-n.width/2+"px";n.style.top=e/2-n.height/2+"px";n.style.position="absolute";n.style.cssText+="-webkit-animation-name: navy_loading; -webkit-animation-duration: 1s; -webkit-animation-timing-function: linear; -webkit-animation-iteration-count: infinite;";i.appendChild(n);var s=document.createElement("style");s.textContent="@-webkit-keyframes navy_loading { 0% { -webkit-transform: rotate(0deg); }  100% { -webkit-transform: rotate(360deg); }";document.head.appendChild(s)})}},_createScene:function(t,e){var i=this._cloneObject(Navy.Config.scene[t]);Navy.Asset.loadScript(i.classFile,this._onLoadScript.bind(this,i,e))},_onLoadScript:function(t,e){var i=Navy.Asset.getClass(t.class);var n=new i(t,e);n.setVisible(false);this.addView(n)},_addScene:function(t,e){t.trigger("Create",e);t.trigger("ResumeBefore");var i=this._getCurrentStack();if(i){var n=i.scene;n.trigger("PauseBefore")}var a=Navy.Asset.getClass(t.getLayout().extra.transition.class);var s=new a(n,t);this._sceneStack.push({scene:t,transition:s});s.start(this._onTransitionStartEnd.bind(this))},_removeCurrentScene:function(){var t=this._sceneStack.pop();t.scene.destroy()},_getCurrentStack:function(){if(this._sceneStack.length>=1){return this._sceneStack[this._sceneStack.length-1]}else{return null}},_getPrevStack:function(){if(this._sceneStack.length>=2){return this._sceneStack[this._sceneStack.length-2]}else{return null}},_onTransitionStartEnd:function(){var t=this._getPrevStack();if(t){t.scene.trigger("PauseAfter")}var e=this._getCurrentStack();if(e){e.scene.trigger("ResumeAfter")}this.unlockView()},_onTransitionBackEnd:function(){var t=this._getPrevStack();if(t){t.scene.trigger("ResumeAfter")}var e=this._getCurrentStack();if(e){e.scene.trigger("PauseAfter");e.scene.trigger("Destroy");this._removeCurrentScene()}this.unlockView()}});Navy.Class("Navy.Scene",Navy.ViewGroup.ViewGroup,{LIFE_CYCLE_STATE_CREATE:1,LIFE_CYCLE_STATE_RESUME_BEFORE:2,LIFE_CYCLE_STATE_RESUME_AFTER:3,LIFE_CYCLE_STATE_PAUSE_BEFORE:4,LIFE_CYCLE_STATE_PAUSE_AFTER:5,LIFE_CYCLE_STATE_DESTROY:6,_lifeCycleState:0,_pageStack:null,_sceneFixedFirstView:null,initialize:function($super,t,e){this._pageStack=[];$super(t,function(){var i=this._viewsOrder[0];this._sceneFixedFirstView=this._views[i];this.nextPage(t.extra.page,null,e.bind(null,this))}.bind(this))},setLayout:function($super,t,e){t.visible=true;t.pos={x:0,y:0};t.sizePolicy={width:this.SIZE_POLICY_FIXED,height:this.SIZE_POLICY_FIXED};t.size={width:Navy.Config.app.size.width,height:Navy.Config.app.size.height};$super(t,e)},setPage:function(t){},getPage:function(){return null},setScene:function(t){},getScene:function(){return this},getCurrentPage:function(){var t=this._getCurrentStack();return t.page},getPageStackCount:function(){return this._pageStack.length},linkPage:function(t,e){if(t==="$back"){this.backPage(e)}else{this.nextPage(t,e)}},nextPage:function(t,e,i){Navy.Root.lockView();Navy.History.forwarded();this._createPage(t,function(t){this._addPage(t,e);i&&i(t)}.bind(this))},backPage:function(t){if(this._pageStack.length>=2){Navy.Root.lockView();Navy.History.backed();var e=this._getCurrentStack();var i=this._getPrevStack();e.page.trigger("PauseBefore");i.page.trigger("ResumeBefore",t);var n=e.transition;n.back(this._onTransitionBackEnd.bind(this))}},onCreate:function(t){this._lifeCycleState=this.LIFE_CYCLE_STATE_CREATE;t.addDefaultCallback(function(){var e=this.getCurrentPage();e.trigger("Create",t.data)})},onResumeBefore:function(t){this._lifeCycleState=this.LIFE_CYCLE_STATE_PAUSE_BEFORE;t.addDefaultCallback(function(){var e=this.getCurrentPage();e.trigger("ResumeBefore",t.data)})},onResumeAfter:function(t){this._lifeCycleState=this.LIFE_CYCLE_STATE_PAUSE_AFTER;t.addDefaultCallback(function(){var e=this.getCurrentPage();e.trigger("ResumeAfter",t.data)})},onPauseBefore:function(t){this._lifeCycleState=this.LIFE_CYCLE_STATE_PAUSE_BEFORE;t.addDefaultCallback(function(){var e=this.getCurrentPage();e.trigger("PauseBefore",t.data)})},onPauseAfter:function(t){this._lifeCycleState=this.LIFE_CYCLE_STATE_PAUSE_AFTER;t.addDefaultCallback(function(){var e=this.getCurrentPage();e.trigger("PauseAfter",t.data)})},onDestroy:function(t){this._lifeCycleState=this.LIFE_CYCLE_STATE_DESTROY;t.addDefaultCallback(function(){var e=this.getCurrentPage();e.trigger("Destroy",t.data)})},_createPage:function(t,e){var i=this._cloneObject(Navy.Config.page[t]);Navy.Asset.loadScript(i.classFile,this._onLoadScript.bind(this,i,e))},_createPageByLayout:function(t,e){var i=Navy.Asset.getClass(t.class);var n=new i(t,e);this.addView(n,this._sceneFixedFirstView)},_onLoadScript:function(t,e){var i=Navy.Asset.getClass(t.class);var n=new i(t,e);n.setVisible(false);this.addView(n,this._sceneFixedFirstView)},_addPage:function(t,e){this._lifeCycleState>=this.LIFE_CYCLE_STATE_CREATE&&t.trigger("Create",e);this._lifeCycleState>=this.LIFE_CYCLE_STATE_RESUME_BEFORE&&t.trigger("ResumeBefore");var i=this._getCurrentStack();if(i){var n=i.page;n.trigger("PauseBefore")}var a=Navy.Asset.getClass(t.getLayout().extra.transition.class);var s=new a(n,t);this._pageStack.push({page:t,transition:s});s.start(this._onTransitionStartEnd.bind(this))},_getCurrentStack:function(){if(this._pageStack.length>=1){return this._pageStack[this._pageStack.length-1]}else{return null}},_getPrevStack:function(){if(this._pageStack.length>=2){return this._pageStack[this._pageStack.length-2]}else{return null}},_onTransitionStartEnd:function(){var t=this._getPrevStack();if(t){t.page.trigger("PauseAfter")}var e=this._getCurrentStack();if(e){this._lifeCycleState>=this.LIFE_CYCLE_STATE_RESUME_AFTER&&e.page.trigger("ResumeAfter")}Navy.Root.unlockView()},_onTransitionBackEnd:function(){var t=this._getPrevStack();if(t){t.page.trigger("ResumeAfter")}var e=this._getCurrentStack();if(e){e.page.trigger("PauseAfter");e.page.trigger("Destroy");var i=this._pageStack.pop();i.page.destroy()}Navy.Root.unlockView()}});Navy.Class("Navy.Transition.Transition",{initialize:function(t,e){},start:function(t){},back:function(t){}});Navy.Class("Navy.Transition.Fade",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}t&&t._setRawStyle({webkitAnimation:"0.5s"});e._setRawStyle({webkitAnimation:"0.5s",opacity:0});e.setVisible(true)},_addAnimationStyle:function(){var t="@-webkit-keyframes fade_in  {100% {opacity: 1}}";var e="@-webkit-keyframes fade_out {100% {opacity: 0}}";var i=document.createElement("style");i.textContent=t+e;document.head.appendChild(i)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({opacity:""});t&&t();return}var e=function(){this._beforeView.setVisible(false);this._beforeView._setRawStyle({webkitAnimationName:""});this._beforeView.removeRawEventListener("webkitAnimationEnd",e);this._afterView.addRawEventListener("webkitAnimationEnd",i);this._afterView._setRawStyle({opacity:0,webkitAnimationName:"fade_in"})}.bind(this);var i=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",i);this._afterView._setRawStyle({opacity:"",webkitAnimationName:"none"});t&&t()}.bind(this);this._beforeView.addRawEventListener("webkitAnimationEnd",e);this._beforeView._setRawStyle({webkitAnimationName:"fade_out"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.setVisible(false);this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"none"});this._beforeView.addRawEventListener("webkitAnimationEnd",i);this._beforeView._setRawStyle({opacity:0,webkitAnimationName:"fade_in"});this._beforeView.setVisible(true)}.bind(this);var i=function(){this._beforeView.removeRawEventListener("webkitAnimationEnd",i);this._beforeView._setRawStyle({opacity:"",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"fade_out"})}});Navy.Class("Navy.Transition.PopUp",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}e._setRawStyle({webkitAnimation:"0.5s",webkitTransform:"scale(0)"});e.setVisible(true)},_addAnimationStyle:function(){var t="@-webkit-keyframes pop_up_in  {100% {-webkit-transform: scale(1)}}";var e="@-webkit-keyframes pop_up_out {100% {-webkit-transform: scale(0)}}";var i=document.createElement("style");i.textContent=t+e;document.head.appendChild(i)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({webkitTransform:""});t&&t();return}var e=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitTransform:"",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"pop_up_in"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.setVisible(false);this._beforeView.setVisible(true);t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"pop_up_out"})}});Navy.Class("Navy.Transition.SlideDown",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}var i=Navy.Config.app.size.height;e._setRawStyle({webkitAnimation:"0.5s",webkitTransform:"translateY(-"+i+"px)"});e.setVisible(true)},_addAnimationStyle:function(){var t=Navy.Config.app.size.height;var e="@-webkit-keyframes slide_up_in  {100% {-webkit-transform: translateY(0)}}";var i="@-webkit-keyframes slide_up_out {100% {-webkit-transform: translateY(-%height%px)}}".replace("%height%",t);var n=document.createElement("style");n.textContent=e+i;document.head.appendChild(n)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({webkitTransform:"none"});t&&t();return}var e=function(){this._beforeView.setVisible(false);this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_up_in"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",e);t&&t()}.bind(this);this._beforeView.setVisible(true);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_up_out"})}});Navy.Class("Navy.Transition.SlideLeft",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}var i=Navy.Config.app.size.width;e._setRawStyle({webkitAnimation:"0.5s",webkitTransform:"translateX(-"+i+"px)"});e.setVisible(true)},_addAnimationStyle:function(){var t=Navy.Config.app.size.width;var e="@-webkit-keyframes slide_left_in  {100% {-webkit-transform: translateX(0)}}";var i="@-webkit-keyframes slide_left_out {100% {-webkit-transform: translateX(-%width%px)}}".replace("%width%",t);var n=document.createElement("style");n.textContent=e+i;document.head.appendChild(n)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({webkitTransform:"none"});t&&t();return}var e=function(){this._beforeView.setVisible(false);this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_left_in"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",e);t&&t()}.bind(this);this._beforeView.setVisible(true);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_left_out"})}});Navy.Class("Navy.Transition.SlideRight",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}var i=Navy.Config.app.size.width;e._setRawStyle({webkitAnimation:"0.5s",webkitTransform:"translateX("+i+"px)"});e.setVisible(true)},_addAnimationStyle:function(){var t=Navy.Config.app.size.width;var e="@-webkit-keyframes slide_right_in  {100% {-webkit-transform: translateX(0)}}";var i="@-webkit-keyframes slide_right_out {100% {-webkit-transform: translateX(%width%px)}}".replace("%width%",t);var n=document.createElement("style");n.textContent=e+i;document.head.appendChild(n)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({webkitTransform:"none"});t&&t();return}var e=function(){this._beforeView.setVisible(false);this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_right_in"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",e);t&&t()}.bind(this);this._beforeView.setVisible(true);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_right_out"})}});Navy.Class("Navy.Transition.SlideUp",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}var i=Navy.Config.app.size.height;e._setRawStyle({webkitAnimation:"0.5s",webkitTransform:"translateY("+i+"px)"});e.setVisible(true)},_addAnimationStyle:function(){var t=Navy.Config.app.size.height;var e="@-webkit-keyframes slide_up_in  {100% {-webkit-transform: translateY(0)}}";var i="@-webkit-keyframes slide_up_out {100% {-webkit-transform: translateY(%height%px)}}".replace("%height%",t);var n=document.createElement("style");n.textContent=e+i;document.head.appendChild(n)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({webkitTransform:"none"});t&&t();return}var e=function(){this._beforeView.setVisible(false);this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_up_in"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",e);t&&t()}.bind(this);this._beforeView.setVisible(true);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimationName:"slide_up_out"})}});Navy.Class("Navy.Transition.TurnOver",Navy.Transition.Transition,{$static:{initAnimationStyle:false},_beforeView:null,_afterView:null,initialize:function(t,e){this._beforeView=t;this._afterView=e;if(!this.$class.initAnimationStyle){this._addAnimationStyle();this.$class.initAnimationStyle=true}t._setRawStyle({webkitAnimation:"0.25s",webkitAnimationTimingFunction:"linear",webkitTransform:"rotateY(0)"});e._setRawStyle({webkitAnimation:"0.25s",webkitAnimationTimingFunction:"linear",webkitTransform:"rotateY(-90deg)"});e.setVisible(true)},_addAnimationStyle:function(){var t="      @-webkit-keyframes turn_over_in_before_view {100% {-webkit-transform: rotateY(90deg)} }      @-webkit-keyframes turn_over_in_after_view {100% {-webkit-transform: rotateY(0)} }";var e="      @-webkit-keyframes turn_over_out_before_view {100% {-webkit-transform: rotateY(0)} }      @-webkit-keyframes turn_over_out_after_view {100% {-webkit-transform: rotateY(-90deg)} }";var i=document.createElement("style");i.textContent=t+e;document.head.appendChild(i)},start:function(t){if(!this._beforeView){this._afterView._setRawStyle({webkitTransform:"none"});t&&t();return}var e=function(){this._beforeView.setVisible(false);this._beforeView.removeRawEventListener("webkitAnimationEnd",e);this._beforeView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});this._afterView.setVisible(true);this._afterView.addRawEventListener("webkitAnimationEnd",i);this._afterView._setRawStyle({webkitAnimationName:"turn_over_in_after_view"})}.bind(this);var i=function(){this._afterView.removeRawEventListener("webkitAnimationEnd",i);this._afterView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.setVisible(false);this._beforeView.addRawEventListener("webkitAnimationEnd",e);this._beforeView._setRawStyle({webkitAnimationName:"turn_over_in_before_view"})},back:function(t){if(!this._beforeView){t&&t();return}var e=function(){this._afterView.setVisible(false);this._afterView.removeRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});this._beforeView._setRawStyle({webkitAnimation:"0.25s",webkitAnimationTimingFunction:"linear",webkitTransform:"rotateY(90deg)"});this._beforeView.setVisible(true);this._beforeView.addRawEventListener("webkitAnimationEnd",i);this._beforeView._setRawStyle({webkitAnimationName:"turn_over_out_before_view"})}.bind(this);var i=function(){this._beforeView.removeRawEventListener("webkitAnimationEnd",i);this._beforeView._setRawStyle({webkitTransform:"none",webkitAnimationName:"none"});t&&t()}.bind(this);this._afterView.addRawEventListener("webkitAnimationEnd",e);this._afterView._setRawStyle({webkitAnimation:"0.25s",webkitAnimationTimingFunction:"linear",webkitTransform:"rotateY(0)"});this._afterView._setRawStyle({webkitAnimationName:"turn_over_out_after_view"})}});Navy.Class("Navy.Gesture.Gesture",{isStart:false,initialize:function(t,e){this._element=t;this._callback=e},start:function(){},stop:function(){}});Navy.Class("Navy.Gesture.Tap",Navy.Gesture.Gesture,{TAP_ALLOW_DISTANCE:350,_trigger:false,_startX:null,_startY:null,initialize:function($super,t,e){$super(t,e);this._touchstart=this._touchstart.bind(this);this._touchmove=this._touchmove.bind(this);this._touchend=this._touchend.bind(this)},start:function($super){$super();this._element.addEventListener("touchstart",this._touchstart)},stop:function($super){$super();this._element.removeEventListener("touchstart",this._touchstart)},_touchstart:function(t){if(t.touches.length>1){return}this._trigger=true;this._startX=t.changedTouches[0].clientX;this._startY=t.changedTouches[0].clientY;this._element.addEventListener("touchmove",this._touchmove);this._element.addEventListener("touchend",this._touchend)},_touchmove:function(t){this._judgeTapAllowDistance(t)},_touchend:function(t){this._element.removeEventListener("touchmove",this._touchmove);this._element.removeEventListener("touchend",this._touchend);this._judgeTapAllowDistance(t);this._trigger&&this._callback(t)},_judgeTapAllowDistance:function(t){var e=this._startX;var i=this._startY;var n=t.changedTouches[0].clientX;var a=t.changedTouches[0].clientY;var s=Math.pow(Math.abs(e-n),2)+Math.pow(Math.abs(i-a),2);if(s>=this.TAP_ALLOW_DISTANCE){this._trigger=false}}})})();